<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
    <title>Comatose :: Inline Rendering with ActionMailer</title>
    <script src="../../theme/scripts/code_highlighter.js"></script>
    <script src="../../theme/scripts/code_syntax.js"></script>
    <link href="../../theme/styles/main.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="../../theme/styles/code_syntax.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="../../posts/feed.xml" title="RSS Feed" rel="alternate" type="application/rss+xml" />
    <script type="text/javascript" src="http://www.haloscan.com/load/comatose"></script>
    
  </head>
  <body>
    <div class="header-logo">
      <div class="header-text">
        <h1>Comatose</h1>
        <div class="subtitle">
          The Rails Micro CMS Plugin
        </div>
      </div>
    </div>
    <div class="sidebar">
      <div class="navigation">
        <ul>
          <li><a href="../../index.html">Home</a></li>
          <li><a href="../../posts/index.html">Devblog</a></li>
          <li><a href="../../pages/getting-started/index.html">Getting Started</a></li>
          <li><a href="../../pages/index.html">Tutorials</a></li>
          <li><a href="http://github.com/darthapo/comatose/tree/master">@GitHub</a></li>
          <li><a href="http://code.google.com/p/comatose-plugin/issues/entry">Report A Bug</a></li>
        </ul>
        
        <div class="donation">
        <form action="https://www.paypal.com/cgi-bin/webscr" method="post">
        <input name="cmd" type="hidden" value="_s-xclick" />
        <input name="submit" type="image" src="https://www.paypal.com/en_US/i/btn/x-click-but21.gif" border="0" alt="Make payments with PayPal - it's fast, free and secure!" />
        <img src="https://www.paypal.com/en_US/i/scr/pixel.gif" border="0" height="1" alt="" width="1" />
        <input name="encrypted" type="hidden" value="-----BEGIN PKCS7-----MIIHkAYJKoZIhvcNAQcEoIIHgTCCB30CAQExggEwMIIBLAIBADCBlDCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20CAQAwDQYJKoZIhvcNAQEBBQAEgYCnMLaTXCmm8VTZGWseMI+xnEPcZv1smYnvQ1ZnFbzC66kAVM3ibJSo68wDhe8Kvwcesd6zywStqoKpJ8RoyA4A8mlnnAGuMl89UsTLg1wXe5YK4tmdOPmJfi9CE8ZjbABwsEkb0jWEOCtgISdL0wbgj4RADwsUMsgRtNtfbNXGBzELMAkGBSsOAwIaBQAwggEMBgkqhkiG9w0BBwEwFAYIKoZIhvcNAwcECNF6XlevbHrkgIHojtnANTvh3RIvY5CWaGEibgpd8v2IPKriZpeQDCQyYJmsNDrKv9IeaiBvxy1DPjCEoxFSHei7qmhAvNRFMYzindDnISLdrP6g5m0O3ykYaDbHWCGSR5BdbX9Kd2egoCMd8AC1iUhadyx5shsVxhfJfOwnsKpjCddk6kGtaS1H4pvyBQ8RFeNjsTF03eDJUakxu4FjFx8mF1zmb2FstfPEiRZ/s7uQfLWw6UOjMS/nDOQFRa3tUPlYg2FUH/ZPYaUjcHxiQzyANJTBW4uAsk9OH76OsL6omw/eh76NgfazfzD5TpZb6Pc0oKCCA4cwggODMIIC7KADAgECAgEAMA0GCSqGSIb3DQEBBQUAMIGOMQswCQYDVQQGEwJVUzELMAkGA1UECBMCQ0ExFjAUBgNVBAcTDU1vdW50YWluIFZpZXcxFDASBgNVBAoTC1BheVBhbCBJbmMuMRMwEQYDVQQLFApsaXZlX2NlcnRzMREwDwYDVQQDFAhsaXZlX2FwaTEcMBoGCSqGSIb3DQEJARYNcmVAcGF5cGFsLmNvbTAeFw0wNDAyMTMxMDEzMTVaFw0zNTAyMTMxMDEzMTVaMIGOMQswCQYDVQQGEwJVUzELMAkGA1UECBMCQ0ExFjAUBgNVBAcTDU1vdW50YWluIFZpZXcxFDASBgNVBAoTC1BheVBhbCBJbmMuMRMwEQYDVQQLFApsaXZlX2NlcnRzMREwDwYDVQQDFAhsaXZlX2FwaTEcMBoGCSqGSIb3DQEJARYNcmVAcGF5cGFsLmNvbTCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAwUdO3fxEzEtcnI7ZKZL412XvZPugoni7i7D7prCe0AtaHTc97CYgm7NsAtJyxNLixmhLV8pyIEaiHXWAh8fPKW+R017+EmXrr9EaquPmsVvTywAAE1PMNOKqo2kl4Gxiz9zZqIajOm1fZGWcGS0f5JQ2kBqNbvbg2/Za+GJ/qwUCAwEAAaOB7jCB6zAdBgNVHQ4EFgQUlp98u8ZvF71ZP1LXChvsENZklGswgbsGA1UdIwSBszCBsIAUlp98u8ZvF71ZP1LXChvsENZklGuhgZSkgZEwgY4xCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEWMBQGA1UEBxMNTW91bnRhaW4gVmlldzEUMBIGA1UEChMLUGF5UGFsIEluYy4xEzARBgNVBAsUCmxpdmVfY2VydHMxETAPBgNVBAMUCGxpdmVfYXBpMRwwGgYJKoZIhvcNAQkBFg1yZUBwYXlwYWwuY29tggEAMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADgYEAgV86VpqAWuXvX6Oro4qJ1tYVIT5DgWpE692Ag422H7yRIr/9j/iKG4Thia/Oflx4TdL+IFJBAyPK9v6zZNZtBgPBynXb048hsP16l2vi0k5Q2JKiPDsEfBhGI+HnxLXEaUWAcVfCsQFvd2A1sxRr67ip5y2wwBelUecP3AjJ+YcxggGaMIIBlgIBATCBlDCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20CAQAwCQYFKw4DAhoFAKBdMBgGCSqGSIb3DQEJAzELBgkqhkiG9w0BBwEwHAYJKoZIhvcNAQkFMQ8XDTA2MDgzMTA5MTk1MFowIwYJKoZIhvcNAQkEMRYEFBbO0hyFDblASYprYh18hxSgmQKcMA0GCSqGSIb3DQEBAQUABIGAn4X4bgjkKOMDl2ap8/tdUdWyFXXfceqrTcMzkhOx6pWQxTqOkIDOhZG9mgmGZ1zlwvPJRRPTA8bSJr/heS4xcpmF5ZL2cGogmvB5gqn75w4FaG4y86oH+bVIeWJ9fN4sxPeAYVLGeavnVYWDAdruoR5stYW4rhBMUth/rhv+uWA=-----END PKCS7-----" />
        </form>
        </div>
        
        <div class="recent-comments">
          <h3>Recent Comments...</h3>
          <script type="text/javascript" src="http://www.haloscan.com/members/recent/comatose/"> </script>
        </div>

        <p>&nbsp;</p>
        
        <div class="sidebar-ad">
          <script type="text/javascript"><!--
          google_ad_client = "pub-4148538552356376";
          google_alternate_color = "FFFFFF";
          google_ad_width = 120;
          google_ad_height = 240;
          google_ad_format = "120x240_as";
          google_ad_type = "text_image";
          google_ad_channel ="3834916953";
          google_color_border = "CCCCCC";
          google_color_bg = "FFFFFF";
          google_color_link = "7F7F7F";
          google_color_text = "000000";
          google_color_url = "008000";
          //--></script>
          <script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
          </script>
        </div>
      </div>
    </div>
    <div class="page-container">
      <div class="contents">
        <div id="header-ad">
          <script type="text/javascript"><!--
          google_ad_client = "pub-4148538552356376";
          google_alternate_color = "FFFFFF";
          google_ad_width = 120;
          google_ad_height = 90;
          google_ad_format = "120x90_0ads_al";
          google_ad_channel ="3834916953";
          google_color_border = "CCCCCC";
          google_color_bg = "FFFFFF";
          google_color_link = "7F7F7F";
          google_color_text = "000000";
          google_color_url = "008000";
          //--></script>
          <script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
          </script>
        </div>
        
<div class="pager">

  <a href="../../posts/version-0-6-9/index.html" class="prev">&laquo; Version 0.6.9</a>

<a href="../../posts/index.html" class="up">&#9679;</a>

  <a href="../../posts/oh-and-im-back/index.html" class="next">Oh, And I'm Back &raquo;</a>

</div>
<div class="post">
  <h2>Inline Rendering with ActionMailer</h2>
  <div class="meta">
    Published on 08/02/2006. 270 words. <span class="comments" title="Comments"><a href="javascript:HaloScan('inline-rendering-with-actionmailer');" target="_self"><script type="text/javascript">postCount('inline-rendering-with-actionmailer');</script></a></span>
  </div>
  <div class="body">
    
<p>Notes from <em>David Vrensk</em> on how to use Comatose&#8217;s inline rendering with <code>ActionMailer</code>:</p>

<blockquote>
<p>My app has to send out confirmation emails, and I use <code>ActionMailer</code> to do that. I want the site owner to be able to update (part of) the email template, so I put that part in a Comatose page. In the email template, I put</p>

<pre><code>&lt;%% render :comatose =&gt; &quot;email-text&quot; %&gt;</code></pre>

<p>But this triggers the error</p>

<pre><code>ActionView::TemplateError (undefined method `read_fragment&#39; for #&lt;notifier:0x23849e4&gt;) on line #15 of
app/views/notifier/order_confirmation.rhtml:
...
    #{RAILS_ROOT}/vendor/plugins/comatose/lib/support/inline_rendering.rb:30:in `render_cached_comatose_page&#39;
    #{RAILS_ROOT}/vendor/plugins/comatose/lib/support/inline_rendering.rb:20:in `render_comatose&#39;
    #{RAILS_ROOT}/vendor/plugins/comatose/lib/support/inline_rendering.rb:7:in `render&#39;
    #{RAILS_ROOT}/app/views/notifier/order_confirmation.rhtml:15:in `_run_rhtml_order_confirmation&#39;</code></pre>

<p>(Notifier is my descendant from <code>ActionMailer::Base</code>.) Apparently, <code>ActionMailer</code> tells <code>ActionView</code> that it is the calling controller. That&#8217;s duck typing for you.</p>

<p>I don&#8217;t have a fix (don&#8217;t know Rails or Comatose well enough yet), but I have a work-around if anyone is interested:</p>

<ol>
<li>
<p>Comatose only tries to call <code>#read_fragment</code> if it uses fragment caching. So, turn of fragment caching for this call:</p>

<pre><code> &lt;%% render :comatose =&gt; &quot;email-text&quot;, :use_cache =&gt; false %&gt;</code></pre>
</li>

<li>
<p>Comatose will now try to render as usual, passing the original request parameters to the Page. But to do this, it has to pick up the params from the controller. Again, the controller is unavailable, but this page doesn&#8217;t need the params anyway, so I fake them by adding</p>

<p>def params Hash.new end</p>
</li>
</ol>

<p>to <code>Notifier</code>, my <code>ActionMailer::Base</code> descendant. And now, all is good. Hacky, but good.</p>
</blockquote>

<p>Thanks David!</p>

  </div>
</div>
        <br /><br />
        <div id="post-content-ad">
          <script type="text/javascript"><!--
           google_ad_client = "pub-4148538552356376";
           google_alternate_color = "FFFFFF";
           google_ad_width = 468;
           google_ad_height = 60;
           google_ad_format = "468x60_as";
           google_ad_type = "text_image";
           google_ad_channel ="3834916953";
           google_color_border = "CCCCCC";
           google_color_bg = "FFFFFF";
           google_color_link = "7F7F7F";
           google_color_text = "000000";
           google_color_url = "008000";
          //--></script>
          <script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
        </div>
      </div>
      <div class="footer">
        <p><a href="http://github.com/darthapo/comatose">Comatose</a> is developed by <a href="http://mattmccray.com">M@ McCray</a> and is released under the MIT license. This site was generated with <a href="http://github.com/darthapo/stratus">Stratus</a>.</p>
        <!-- <p>Copyright M@ McCray.</p> -->
      </div>
    </div>
  </body>
  <script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script>
  <script type="text/javascript">
  _uacct = "UA-632821-3";
  urchinTracker();
  </script>
</html>